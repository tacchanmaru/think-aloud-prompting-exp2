(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1057:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var s=a(5155),r=a(2115),o=a(9911),c=a(3319);let n=e=>{let{isOpen:t,onClose:a,settings:c,onSave:n}=e,[l,i]=(0,r.useState)(c);if((0,r.useEffect)(()=>{i(c)},[c,t]),!t)return null;let d=(e,t)=>{let a={...l,[e]:t};i(a),n(a)};return(0,s.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target===e.currentTarget&&a()},children:(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsx)("h2",{children:"設定"}),(0,s.jsx)("button",{onClick:a,className:"close-button",children:(0,s.jsx)(o.QCr,{})})]}),(0,s.jsxs)("div",{className:"modal-body",children:[(0,s.jsxs)("div",{className:"setting-item",children:[(0,s.jsx)("label",{htmlFor:"scrapboxProject",children:"Scrapbox プロジェクト名"}),(0,s.jsx)("input",{id:"scrapboxProject",type:"text",value:l.scrapboxProject,onChange:e=>d("scrapboxProject",e.target.value)})]}),(0,s.jsxs)("div",{className:"setting-item",children:[(0,s.jsx)("label",{htmlFor:"scrapboxTitleFormat",children:"Scrapbox 日付形式"}),(0,s.jsx)("input",{id:"scrapboxTitleFormat",type:"text",value:l.scrapboxTitleFormat,onChange:e=>d("scrapboxTitleFormat",e.target.value)}),(0,s.jsxs)("p",{className:"setting-help",children:[(0,s.jsx)("code",{children:"yyyy"}),", ",(0,s.jsx)("code",{children:"MM"}),", ",(0,s.jsx)("code",{children:"dd"})," が使用できます。例: ",(0,s.jsx)("code",{children:"yyyy-MM-dd"})]})]})]})]})})},l=function(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(""),[i,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[x,j]=(0,r.useState)(!1),[y,b]=(0,r.useState)({scrapboxProject:"rchujo",scrapboxTitleFormat:"yyyyMMdd"}),g=(0,r.useRef)(null),v=(0,r.useRef)(null),N=(0,r.useRef)([]),f=(0,r.useRef)(null);(0,r.useEffect)(()=>{g.current&&e.length>0&&(g.current.scrollTop=g.current.scrollHeight)},[e]),(0,r.useEffect)(()=>{try{let e=localStorage.getItem("notes-app-data");e&&t(JSON.parse(e));let a=localStorage.getItem("notes-app-settings");a&&b(JSON.parse(a))}catch(e){console.error("Failed to load data from localStorage",e),p("データの読み込みに失敗しました。")}},[]),(0,r.useEffect)(()=>{try{localStorage.setItem("notes-app-data",JSON.stringify(e))}catch(e){console.error("Failed to save notes to localStorage",e),p("メモの保存に失敗しました。")}},[e]);let w=async()=>{if(p(null),!i)try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});f.current=e;let t=new MediaRecorder(e,{mimeType:"audio/webm"});v.current=t,N.current=[],t.ondataavailable=e=>{e.data.size>0&&N.current.push(e.data)},t.onstop=async()=>{u(!0);let e=new Blob(N.current,{type:"audio/webm"}),t=new FormData;t.append("audio",e);try{let e=await fetch("/api/transcribe",{method:"POST",body:t});if(!e.ok){let t=await e.json();throw Error(t.error||"文字起こしに失敗しました。")}let a=await e.json();l(e=>e?"".concat(e,"\n").concat(a.transcript):a.transcript)}catch(e){p(e.message||"文字起こし中にエラーが発生しました。")}finally{u(!1)}},t.start(),d(!0)}catch(e){p("マイクへのアクセス許可が必要です。"),console.error("Error starting recording:",e)}},S=()=>{if(v.current&&i){var e;u(!0),v.current.stop(),d(!1),null==(e=f.current)||e.getTracks().forEach(e=>e.stop())}},C=e=>{let t=new Date(e.createdAt),a=(0,c.GP)(t,"HH:mm"),s=encodeURIComponent("[chujo.icon] ".concat(a,"\n").concat(e.content)),r=y.scrapboxTitleFormat.replace(/yyyy/g,(0,c.GP)(t,"yyyy")).replace(/MM/g,(0,c.GP)(t,"MM")).replace(/dd/g,(0,c.GP)(t,"dd")),o="https://scrapbox.io/".concat(y.scrapboxProject,"/").concat(encodeURIComponent(r),"?body=").concat(s);window.open(o,"_blank")},P=async e=>{if(navigator.share)try{await navigator.share({title:"Memo from ".concat((0,c.GP)(new Date(e.createdAt),"yyyy/MM/dd")),text:e.content})}catch(e){console.error("Error sharing note:",e),p("共有に失敗しました。")}else try{await navigator.clipboard.writeText(e.content),alert("共有機能が利用できないため、メモの内容をクリップボードにコピーしました。")}catch(e){console.error("Failed to copy to clipboard:",e),p("共有機能が利用できず、クリップボードへのコピーにも失敗しました。")}};return(0,s.jsxs)("div",{className:"memos-container",children:[(0,s.jsxs)("div",{className:"main-header",children:[(0,s.jsx)("h1",{children:y.scrapboxProject}),(0,s.jsx)("button",{onClick:()=>j(!0),className:"settings-button",title:"設定",children:(0,s.jsx)(o.Pcn,{})})]}),h&&(0,s.jsx)("p",{className:"error",children:h}),(0,s.jsx)("div",{className:"notes-list",ref:g,children:[...e].reverse().map(e=>(0,s.jsxs)("div",{className:"note-card",children:[(0,s.jsx)("div",{className:"note-content",onClick:()=>l(e.content),children:e.content.split("\n").map((e,t)=>(0,s.jsx)("p",{className:"note-paragraph",children:e||" "},t))}),(0,s.jsxs)("div",{className:"note-footer",children:[(0,s.jsx)("span",{className:"note-date",children:(0,c.GP)(new Date(e.createdAt),"yyyy/MM/dd HH:mm")}),(0,s.jsx)("button",{className:"share-button",onClick:t=>{t.stopPropagation(),P(e)},title:"共有する",children:(0,s.jsx)(o.eb3,{})})]})]},e.id))}),(0,s.jsxs)("div",{className:"new-memo-area ".concat(i?"recording":""),children:[(i||m)&&(0,s.jsx)("div",{className:"status-overlay",children:i?"音声認識中...":"文字起こし中..."}),(0,s.jsx)("textarea",{value:a,onChange:e=>l(e.target.value),className:"memo-input ".concat(i?"recording":""),placeholder:i||m?"":"What do you think now...",rows:4}),(0,s.jsxs)("div",{className:"memo-actions",children:[(0,s.jsx)("button",{className:"record-button ".concat(i?"recording":""),onClick:()=>{i?S():w()},disabled:m,title:i?"録音停止":"録音開始",children:m?(0,s.jsx)("div",{className:"spinner-small"}):i?(0,s.jsx)(o.wFo,{}):(0,s.jsx)(o.i0t,{})}),(0,s.jsxs)("div",{className:"action-buttons",children:[(0,s.jsx)("button",{className:"reset-button",onClick:()=>{l("")},disabled:!a.trim(),title:"リセット",children:(0,s.jsx)(o.qbC,{})}),(0,s.jsx)("button",{className:"post-button",onClick:()=>{let e=a.trim();if(!e)return;let s={id:Date.now(),content:e,createdAt:new Date().toISOString()};t(e=>[s,...e]),l(""),C(s)},disabled:!a.trim(),children:"Post"})]})]})]}),(0,s.jsx)(n,{isOpen:x,onClose:()=>j(!1),settings:y,onSave:e=>{b(e);try{localStorage.setItem("notes-app-settings",JSON.stringify(e))}catch(e){console.error("Failed to save settings to localStorage",e),p("設定の保存に失敗しました。")}}})]})}},4104:(e,t,a)=>{Promise.resolve().then(a.bind(a,1057))}},e=>{var t=t=>e(e.s=t);e.O(0,[711,522,441,721,358],()=>t(4104)),_N_E=e.O()}]);